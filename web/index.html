<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Animal Behavior — Schelling's Model</title>
    <link rel="icon" type="image/svg+xml" href="./icon.svg" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="app-header">
      <div class="brand">
        <img src="./icon.svg" alt="Animal Behavior icon" class="app-icon" />
        <div class="titles">
          <h1>Animal Behavior Simulations</h1>
          <p class="subtitle">A HUJI Course on Animal Behavior and Cognition</p>
        </div>
      </div>
      <div class="spacer"></div>
      <div class="sim-tabs-header" role="tablist" aria-label="Simulation selector">
        <button id="tabSchelling" class="tab tab-schelling active" role="tab" aria-selected="true" aria-controls="schellingPanel">Schelling</button>
        <button id="tabLife" class="tab tab-life" role="tab" aria-selected="false" aria-controls="lifePanel">Game of Life</button>
        <button id="tabBoids" class="tab tab-boids" role="tab" aria-selected="false" aria-controls="boidsPanel">Boids</button>
      </div>
      <img src="./huji-logo.svg" alt="The Hebrew University of Jerusalem" class="huji-logo" />
    </header>

    <main class="layout">
      <section class="panel controls">
        <a id="simTitle" class="sim-title" href="https://en.wikipedia.org/wiki/Schelling%27s_model_of_segregation" target="_blank" rel="noopener">Schelling's Model of Segregation</a>
        <h2>Controls</h2>

        <div class="control-group">
          <label for="gridSize">Grid size: <span id="gridSizeValue">40</span> × <span id="gridSizeValue2">40</span></label>
          <input id="gridSize" type="range" min="10" max="120" step="1" value="40" />
        </div>

        <div class="control-group">
          <label for="density">Occupancy (% filled): <span id="densityValue">90</span>%</label>
          <input id="density" type="range" min="0" max="100" step="1" value="90" />
        </div>

        <div id="schellingPanel" class="sim-panel" role="tabpanel" aria-labelledby="tabSchelling">
          <div class="control-group">
            <label for="ratioA">Type A ratio (of agents): <span id="ratioAValue">50</span>%</label>
            <input id="ratioA" type="range" min="0" max="100" step="1" value="50" />
          </div>

          <div class="control-group">
            <label for="tolerance">Minimum similar neighbors: <span id="toleranceValue">50</span>%</label>
            <input id="tolerance" type="range" min="0" max="100" step="1" value="50" />
            <small>Agents are satisfied if at least this percent of neighbors are the same type.</small>
          </div>
        </div>

        <div id="lifePanel" class="sim-panel" role="tabpanel" aria-labelledby="tabLife" hidden>
          <div class="control-group">
            <label for="lifePattern">Initial pattern</label>
            <select id="lifePattern">
              <option value="random" selected>Random</option>
              <option value="glider">Glider</option>
              <option value="blinker">Blinker</option>
              <option value="pulsar">Pulsar</option>
              <option value="gosper">Gosper Glider Gun</option>
            </select>
          </div>
        </div>

        <div id="boidsPanel" class="sim-panel" role="tabpanel" aria-labelledby="tabBoids" hidden>
          <div class="row">
            <div class="control-group sm">
              <label for="boidsCount">Boids: <span id="boidsCountValue">150</span></label>
              <input id="boidsCount" type="range" min="10" max="1000" step="10" value="150" />
            </div>
            <div class="control-group sm">
              <label for="perception">Perception radius: <span id="perceptionValue">50</span></label>
              <input id="perception" type="range" min="10" max="200" step="5" value="50" />
            </div>
          </div>
          <div class="row">
            <div class="control-group sm">
              <label for="separationDist">Separation distance: <span id="separationDistValue">20</span></label>
              <input id="separationDist" type="range" min="5" max="100" step="1" value="20" />
            </div>
            <div class="control-group sm">
              <label for="maxSpeed">Max speed: <span id="maxSpeedValue">2.5</span></label>
              <input id="maxSpeed" type="range" min="0.5" max="6" step="0.1" value="2.5" />
            </div>
          </div>
          <div class="row">
            <div class="control-group sm">
              <label for="maxForce">Max force: <span id="maxForceValue">0.05</span></label>
              <input id="maxForce" type="range" min="0.01" max="0.5" step="0.01" value="0.05" />
            </div>
            <div class="control-group sm"></div>
          </div>
          <div class="row">
            <div class="control-group sm">
              <label for="weightSep">Separation weight: <span id="weightSepValue">1.5</span></label>
              <input id="weightSep" type="range" min="0" max="3" step="0.1" value="1.5" />
            </div>
            <div class="control-group sm">
              <label for="weightAlign">Alignment weight: <span id="weightAlignValue">1.0</span></label>
              <input id="weightAlign" type="range" min="0" max="3" step="0.1" value="1.0" />
            </div>
          </div>
          <div class="row">
            <div class="control-group sm">
              <label for="weightCoh">Cohesion weight: <span id="weightCohValue">1.0</span></label>
              <input id="weightCoh" type="range" min="0" max="3" step="0.1" value="1.0" />
            </div>
            <div class="control-group sm"></div>
          </div>
        </div>

        <div class="row">
          <div class="control-group sm">
            <label for="delay">Step delay (ms): <span id="delayValue">100</span></label>
            <input id="delay" type="range" min="0" max="1000" step="10" value="100" />
          </div>
          <div class="control-group sm">
            <label for="maxIterations">Max steps</label>
            <input id="maxIterations" type="number" min="1" max="20000" step="1" value="5000" />
          </div>
        </div>

        <div class="row">
          <label class="checkbox">
            <input id="wrapEdges" type="checkbox" />
            <span>Wrap edges (toroidal)</span>
          </label>
        </div>
        <div class="row" id="unsatRow">
          <label class="checkbox">
            <input id="showUnsatisfied" type="checkbox" checked />
            <span>Show unsatisfied markers</span>
          </label>
        </div>

        <div class="buttons">
          <button id="initializeBtn" class="btn" title="Initialize a new random grid">Initialize</button>
          <div class="btn-right">
            <button id="stepBtn" class="btn fixed" title="Advance one step">
              <span class="icon" aria-hidden="true">
                <svg viewBox="0 0 16 16"><path d="M10 2v12h2V2h-2zM2 2v12l7-6-7-6z"/></svg>
              </span>
              <span class="label">Step</span>
            </button>
            <button id="runBtn" class="btn danger fixed" title="Run until convergence with delay">
              <span class="icon" aria-hidden="true">
                <svg class="play" viewBox="0 0 16 16"><path d="M3 2v12l10-6L3 2z"/></svg>
                <svg class="pause" viewBox="0 0 16 16"><path d="M3 2h4v12H3zM9 2h4v12H9z"/></svg>
              </span>
              <span class="label">Run</span>
            </button>
          </div>
        </div>

        <div class="stats">
          <div class="stat"><span class="label">Step</span><span id="statStep">0</span></div>
          <div class="stat"><span class="label">Agents</span><span id="statAgents">0</span></div>
          <div class="stat"><span class="label">Unsatisfied</span><span id="statUnsatisfied">0</span></div>
          <div class="stat"><span class="label">Satisfied</span><span id="statSatisfied">0%</span></div>
          <div class="stat"><span class="label">Moved (last)</span><span id="statMoved">0</span></div>
        </div>
      </section>

      <section class="panel canvas-panel">
        <div class="canvas-header">
          <div class="legend" id="schellingLegend">
            <div class="legend-item"><span class="chip a"></span>Type A</div>
            <div class="legend-item"><span class="chip b"></span>Type B</div>
            <div class="legend-item"><span class="chip empty"></span>Empty</div>
          </div>
          <div class="legend" id="lifeLegend" hidden>
            <div class="legend-item"><span class="chip life-alive"></span>Alive</div>
            <div class="legend-item"><span class="chip life-dead"></span>Dead</div>
          </div>
          <div class="legend" id="boidsLegend" hidden>
            <div class="legend-item"><span class="chip life-alive"></span>Boid</div>
          </div>
        </div>
        <div class="canvas-wrap">
          <canvas id="gridCanvas" width="900" height="900" aria-label="Schelling grid" role="img"></canvas>
        </div>
      </section>

      <aside class="panel rules">
        <h2>Model Rules</h2>

        <div id="schellingRules">
          <h3>Core Rules</h3>
          <ul>
            <li><b>Agents:</b> Two types: A (blue) and B (red). Empty cells are gray.</li>
            <li><b>Neighborhood:</b> Moore neighborhood (8 surrounding cells).</li>
            <li><b>Tolerance:</b> An agent is satisfied if at least the selected percent of its non-empty neighbors are the same type.</li>
            <li><b>No neighbors:</b> Agents with zero neighbors are considered satisfied.</li>
            <li><b>Update rule:</b> In each iteration, all unsatisfied agents relocate in parallel to randomly chosen empty cells.</li>
            <li><b>Convergence:</b> Reached when no agents are unsatisfied or no empty cells remain.</li>
          </ul>
          <h3>Simulation Options</h3>
          <ul>
            <li><b>Wrap edges:</b> When enabled, the grid is a torus; when disabled, borders are bounds. Manual moves and distance calculations respect this.</li>
            <li><b>Step/Run:</b> Advance one iteration or run until convergence using the model’s update rule.</li>
            <li><b>Manual move:</b> Clicking an unsatisfied agent moves it to the nearest empty cell that would satisfy it (if any); otherwise to a random empty cell.</li>
            <li><b>Markers:</b> Toggle <i>Show unsatisfied markers</i> to highlight agents that want to move.</li>
          </ul>
        </div>

        <div id="lifeRules" hidden>
          <h3>Core Rules</h3>
          <ul>
            <li><b>Cells:</b> Each cell is either <i>alive</i> or <i>dead</i>.</li>
            <li><b>Neighborhood:</b> Moore neighborhood (8 surrounding cells).</li>
            <li><b>Birth:</b> A dead cell with exactly 3 live neighbors becomes alive.</li>
            <li><b>Survival:</b> A live cell with 2 or 3 live neighbors stays alive; otherwise it dies.</li>
            <li><b>Sync update:</b> All cells update simultaneously each step.</li>
          </ul>
          <h3>Simulation Options</h3>
          <ul>
            <li><b>Wrap edges:</b> When enabled, the grid is a torus; when disabled, borders are bounds.</li>
            <li><b>Step/Run:</b> Advance a single generation or continuously with a delay.</li>
            <li><b>Initialize:</b> Use <i>Occupancy</i> for random seeds or pick a preset pattern (Glider, Blinker, Pulsar, Gosper Gun).</li>
            <li><b>Edit:</b> Click the grid to toggle cells alive/dead.</li>
          </ul>
        </div>

        <div id="boidsRules" hidden>
          <h3>Core Rules</h3>
          <ul>
            <li><b>Agents:</b> Boids move in continuous space with position and velocity.</li>
            <li><b>Perception:</b> Each boid senses neighbors within a radius.</li>
            <li><b>Separation:</b> Steer to avoid crowding neighbors closer than a separation distance.</li>
            <li><b>Alignment:</b> Steer towards the average direction of nearby boids.</li>
            <li><b>Cohesion:</b> Steer towards the average position (center) of nearby boids.</li>
            <li><b>Limits:</b> Acceleration is limited by <i>max force</i>, speed by <i>max speed</i>.</li>
          </ul>
          <h3>Simulation Options</h3>
          <ul>
            <li><b>Wrap edges:</b> When enabled, boids wrap around; otherwise they bounce at borders.</li>
            <li><b>Sliders:</b> Control boid count, perception radius, separation distance, and weights.</li>
            <li><b>Interaction:</b> Click to add or remove boids (coming soon).</li>
          </ul>
        </div>
      </aside>
    </main>

    <footer class="app-footer">
      <span>Built for demos and simulations in Animal Behavior.</span>
    </footer>

    <script src="./schelling.js"></script>
  </body>
  </html>
